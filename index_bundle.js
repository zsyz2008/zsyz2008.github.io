!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if("name"==o[0])return o[1]}return!1}();let o;fetch("./song/"+n+".json").then(e=>{200!==e.status?console.log("Looks like there was a problem. Status Code: "+e.status):e.json().then((function(e){o=e,document.getElementById("title").textContent=o.header.name;const t=function(e){const t=60/+e.header.tempos[0].bpm*+e.header.timeSignatures[0].timeSignature[0],n={};let o=e.tracks;o=o.filter(e=>0<e.notes.length);const r={},a={},l=(o.filter(e=>0<e.notes.length).forEach((e,t)=>{e.notes.forEach(e=>{var o=e.time;let l=n[o];l?l.push({solo:0===t,name:e.name,duration:e.duration,velocity:e.velocity}):n[o]=[{solo:0===t,name:e.name,duration:e.duration,velocity:e.velocity}],0===t?r[e.name]=e.name:a[e.name]=e.name})}),[]);let i=[],s=Object.keys(n).sort((function(e,t){return+e-+t}));for(var c of s)l.push(n[c]),i.push(c);const u=Math.ceil(i[i.length-1]/t),d={};for(let e=0;e<u;e++){const n=[];for(let o=0;o<i.length;o++)i[o]<(e+1)*t&&i[o]>=e*t&&n.push({index:o,duration:i[o+1]-i[o]||1,solo:-1!==l[o].findIndex(e=>!0===e.solo)});d[(n[0]||"none").index]=n}return{notes:l,times:i,groupMap:d,soloMap:r,bzMap:a}}(o);var{}=t;let n,r;e=new Tone.Chorus(4,2.5,.5).toDestination().start(),r=(new Tone.PolySynth).connect(e),n=new Tone.PolySynth(Tone.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination(),new Tone.Sampler({baseUrl:"samples/flute/",onload:()=>{new Tone.Sampler({baseUrl:"samples/piano/",onload:()=>{{const{playBtn:a,scoreContainer:l,mid:i,instrument:s}={playBtn:document.getElementById("playBtn1"),scoreContainer:document.getElementById("scoreContainer1"),mid:t,instrument:{solo:{synth:n,control:!1},bz:{synth:r,control:!1}}},{notes:c,times:u,groupMap:d}=i,f=s.solo.synth,h=s.solo.control,m=s.bz.synth,p=s.bz.control;let y,g,v,b,w=0,T=0;function e(){T++;const e=d[w];if(e){g=[],l.innerHTML="",T=0;var t=e.reduce((e,t)=>e+t.duration,0);for(let o=0;o<e.length;o++){const r=document.createElement("div");var n=e[o];r.setAttribute("class","list"),r.style.width=100*n.duration/t+"%",r.innerHTML='<div class="avatar"></div>',l.appendChild(r),n.solo?r.children[0].style.backgroundColor="#db5a6b":r.children[0].style.backgroundColor="rgba(252, 201,185)",g.push(r)}y=g.length}}function o(){v&&v.forEach(e=>{e.solo?h&&f.triggerRelease(e.name):p&&m.triggerRelease(e.name)})}e(),a.style.visibility="visible",a.addEventListener("touchstart",t=>{{o();const t=c[w];(v=t).forEach(e=>{e.solo?h?f.triggerAttack(e.name,Tone.now(),.9*e.velocity):f.triggerAttackRelease(e.name,e.duration,Tone.now(),.9*e.velocity):p?m.triggerAttack(e.name,Tone.now(),.3*e.velocity):m.triggerAttackRelease(e.name,e.duration,Tone.now(),.3*e.velocity)});{g&&(g[T].children[0].style.width="0%"),e(),clearInterval(b);const t=g[T],n=u[w],o=u[w+1];let r;r=o?1e3*(o-n):3e3;let a,l=Date.now();b=setInterval(()=>{var e;a<=0?(c[w],clearInterval(b),a=0,t.children[0].style.width="0%"):(a=r-(Date.now()-l),e=Math.ceil(100*a/r),t.children[0].style.width=e+"%")},30)}w===c.length-1?w=0:w++}t.preventDefault()}),a.addEventListener("touchend",e=>{o()})}}}).toDestination()}}).toDestination()}))}),window.onload=function(){Tone.context.resume().then(()=>{Tone.Transport.start(),Tone.getContext().lookAhead=0,Tone.Transport.bpm.value=50})}}]);